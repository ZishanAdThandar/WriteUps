<main>
    {% if page.content %}
    <div class="page-content">
        {{ content }}
    </div>
    {% endif %}
    
    <!-- Get category from page or URL -->
    {% assign current_category = page.category %}
    {% unless current_category %}
        {% assign url_parts = page.url | split: '/' %}
        {% for part in url_parts %}
            {% if part == 'hackthebox' or part == 'tryhackme' or part == 'offsec' or part == 'vulnhub' or part == 'bugbounty' or part == 'blog' %}
                {% assign current_category = part %}
            {% endif %}
        {% endfor %}
    {% endunless %}
    
    <!-- Filter posts by category -->
    {% if current_category %}
        {% assign category_posts = site.posts | where: "category", current_category %}
    {% else %}
        {% assign category_posts = site.posts %}
    {% endif %}
    
    <!-- Fallback: If no posts found with category, try filtering by path -->
    {% if category_posts.size == 0 and current_category %}
        {% assign category_posts = site.posts | where_exp: "post", "post.path contains current_category" %}
    {% endif %}
    
    {% if category_posts.size > 0 %}
    <div class="posts-grid">
        {% for post in category_posts %}
        <article class="post-card">
            <div class="post-card-content">
                <h2 class="post-card-title">
                    <a href="{{ post.url }}">{{ post.title }}</a>
                </h2>
                
                {% if post.excerpt %}
                <p class="post-card-excerpt">{{ post.excerpt | strip_html | truncate: 200 }}</p>
                {% elsif post.description %}
                <p class="post-card-excerpt">{{ post.description | truncate: 200 }}</p>
                {% endif %}
                
                <div class="post-card-meta">
                    <span><i class="far fa-calendar"></i> {{ post.date | date: "%B %d, %Y" }}</span>
                    <span class="post-card-category">
                        {% if post.category == 'hackthebox' %}<i class="fas fa-cube"></i> HTB
                        {% elsif post.category == 'tryhackme' %}<i class="fas fa-tv"></i> THM
                        {% elsif post.category == 'offsec' %}<i class="fas fa-shield-alt"></i> OffSec
                        {% elsif post.category == 'vulnhub' %}<i class="fas fa-server"></i> VulnHub
                        {% elsif post.category == 'bugbounty' %}<i class="fas fa-bug"></i> Bug Bounty
                        {% elsif post.category == 'blog' %}<i class="fas fa-blog"></i> Blog
                        {% else %}<i class="fas fa-file-code"></i> {{ post.category | default: "Post" }}{% endif %}
                    </span>
                </div>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-posts">
        <h2><i class="fas fa-exclamation-triangle"></i> No posts found in this category</h2>
        <p>Check back soon for new content!</p>
        
        <!-- Debug info -->
        <div style="background: rgba(255,0,60,0.1); padding: 1rem; border-radius: 8px; margin: 2rem 0; border: 1px solid #ff003c;">
            <p style="color: #ff003c; margin: 0; font-family: 'Source Code Pro', monospace; font-size: 0.9rem;">
                <i class="fas fa-bug"></i> Debug: 
                Current Category: {{ current_category }} | 
                Page Category: {{ page.category }} | 
                Total Posts: {{ site.posts.size }}
            </p>
        </div>
        
        <div style="margin-top: 2.5rem; display: flex; gap: 1rem; justify-content: center;">
            <a href="/" style="
                display: inline-flex;
                align-items: center;
                gap: 10px;
                padding: 1rem 2rem;
                background: linear-gradient(90deg, var(--primary-dark), var(--secondary-dark));
                color: var(--accent-green);
                text-decoration: none;
                border-radius: 8px;
                border: 1px solid var(--accent-green);
                font-weight: 600;
                transition: all 0.3s;
            ">
                <i class="fas fa-home"></i> Go Home
            </a>
            <a href="/posts" style="
                display: inline-flex;
                align-items: center;
                gap: 10px;
                padding: 1rem 2rem;
                background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));
                color: var(--primary-dark);
                text-decoration: none;
                border-radius: 8px;
                border: 1px solid var(--accent-green);
                font-weight: 600;
                transition: all 0.3s;
            ">
                <i class="fas fa-terminal"></i> View All Posts
            </a>
        </div>
    </div>
    {% endif %}
</main>
